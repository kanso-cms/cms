!function(){function e(e){e=e||window.event;var t=i.options[i.selectedIndex].value;"product"===t?(n.removeClass(d,"active"),n.addClass(l,"active")):"bundle"===t?(n.removeClass(l,"active"),n.addClass(d,"active")):(n.removeClass(d,"active"),n.removeClass(l,"active"))}function t(){for(var e=0;e<p.length;e++)n.addEventListener(p[e],"click",o)}function o(e){e=e||window.event;var t=n.parentUntillClass(this,"tab-panel"),o=n.$('li a[data-tab="'+t.dataset.tabPanel+'"]',u).parentNode;if("offer-1"===t.dataset.tabPanel&&1===n.count(n.$All(".tab-panel",c)))return void Modules.require("Notifications",{type:"warning",msg:"Your product must contain at least one offer."});n.removeFromDOM(o),n.removeFromDOM(t),s();var r=n.$("li:first-child a",u);n.nodeExists(r)&&n.triggerEvent(r,"click")}function r(){var e=n.count(n.$All(".tab-panel",c)),t=e+1,r='<a href="#" data-tab="offer-'+t+'">Offer '+t+"</a>",i=n.clean_inner_html(['<div class="form-field row floor-xs">','<label>SKU</label><input type="text" name="product_offer_'+t+'_id" value="" autocomplete="off" placeholder="SKU001">',"</div>",'<div class="form-field row floor-xs">','<label>Name</label><input type="text" name="product_offer_'+t+'_name" value="" autocomplete="off" placeholder="XXS">',"</div>",'<div class="form-field row floor-xs">','<label>Price</label><input type="text" name="product_offer_'+t+'_price" value="" autocomplete="off" placeholder="19.95">',"</div>",'<div class="form-field row floor-xs">','<label>Sale Price</label><input type="text" name="product_offer_'+t+'_sale_price" value="" autocomplete="off" placeholder="9.95">',"</div>",'<div class="form-field row floor-xs">','<label>Weight (g)</label><input type="text" name="product_offer_'+t+'_weight" value="" autocomplete="off" placeholder="900">',"</div>",'<div class="form-field row floor-xs">','<span class="checkbox checkbox-primary">','<input type="checkbox" name="product_offer_'+t+'_free_shipping" id="product_offer_'+t+'_free_shipping">','<label for="product_offer_'+t+'_free_shipping">Free Shipping</label>',"</span>","</div>",'<div class="form-field row floor-xs">','<span class="checkbox checkbox-primary">','<input type="checkbox" name="product_offer_'+t+'_instock" id="product_offer_'+t+'_instock" checked>','<label for="product_offer_'+t+'_instock">In Stock</label>',"</span>","</div>",'<button class="btn btn-danger js-remove-offer" type="button">Remove Offer</button>']),a=n.newNode("DIV","tab-panel",null,i,c);a.dataset.tabPanel="offer-"+t;n.newNode("LI",null,null,r,u);Modules.refresh("TabNav"),n.triggerEvent(n.$("li:last-of-type > a",u),"click"),n.addEventListener(n.$(".js-remove-offer",a),"click",o),s()}function s(){for(var e=n.$All("li a",u),t=n.$All(".tab-panel",c),o=0;o<e.length;o++)e[o].dataset.tab="offer-"+(o+1),e[o].innerHTML="Offer "+(o+1);for(var r=0;r<t.length;r++)t[r].dataset.tabPanel="offer-"+(r+1)}var n=Modules.get("JSHelper"),i=n.$('.js-writer-form select[name="type"]'),a=n.$(".js-add-product-offer"),l=n.$(".js-product-options"),d=n.$(".js-bundle-options"),c=n.$(".js-product-options .js-tab-panels-wrap"),u=n.$(".js-product-options .js-tab-nav"),p=n.$All(".js-product-options .js-remove-offer");n.nodeExists(l)&&(n.addEventListener(i,"change",e),n.addEventListener(a,"click",r),t(),n.triggerEvent(i,"change"))}(),function(){function e(){for(var e=r.$(".js-add-coupon-btn"),s=r.$All(".js-rmv-coupon-code"),n=0;n<s.length;n++)r.addEventListener(s[n],"click",t);r.addEventListener(e,"click",o)}function t(e){e=e||window.event,e.preventDefault(),r.removeFromDOM(r.parentUntillClass(this,"js-coupon-row"))}function o(e){e=e||window.event,e.preventDefault();var o=r.$(".js-coupon-entries"),s=document.createElement("DIV");s.className="row roof-xs js-coupon-row",s.innerHTML=['<div class="form-field floor-xs">',"<label>Key</label>",'<input type="text" name="coupon_keys[]" value="" autocomplete="off" size="20">','</div>&nbsp;&nbsp;&nbsp;<div class="form-field floor-xs">',"<label>Value</label>",'<input type="text" name="coupon_values[]" value="" autocomplete="off" size="60">','</div>&nbsp;&nbsp;&nbsp;<button class="btn btn-danger js-rmv-coupon-code" type="button">Remove</button>','<div class="row clearfix"></div>'].join(""),o.appendChild(s),r.addEventListener(r.$(".js-rmv-coupon-code",s),"click",t)}var r=Modules.get("JSHelper");r.nodeExists(r.$(".js-add-coupon-btn"))&&e()}(),function(){var e=Modules.get("JSHelper"),t=!1,o=function(){this._bundleType="group",this._bundleSelectEl=e.$(".js-bundle-type-select"),this._bundleTypeOptionsWraps=e.$All(".js-bundle-option"),this._productsList="",this._bogoOptionsWrap=e.$(".js-bundle-option-bogo"),this._bogoProductsTriggerIn=e.$(".js-bogo-products-in-trigger"),this._bogoProductsTriggerOut=e.$(".js-bogo-products-out-trigger"),this._bogoProductsTableIn=e.$(".js-bogo-products-in-table"),this._bogoProductsTableOut=e.$(".js-bogo-products-out-table"),this._groupOptionsWrap=e.$(".js-bundle-option-group"),this._groupProductsTrigger=e.$(".js-group-products-trigger"),this._groupProductsTable=e.$(".js-group-products-table"),this._groupTotalPriceEl=e.$(".js-group-total-price"),this._groupPercentDiscountEl=e.$(".js-group-discount-input"),this._groupFixedPriceEl=e.$(".js-group-fixed-price-input"),this._groupCentsOverrideEl=e.$(".js-group-cents-override-input"),this._comboOptionsWrap=e.$(".js-bundle-option-combo"),this._comboProductsTriggers=e.$All(".js-combo-products-trigger"),this._comboProductsTables=e.$All(".js-combo-products-table"),this._comboAddTableEl=e.$(".js-bundle-combo-selection-add-trigger"),e.nodeExists(e.$(".js-bundle-options"))&&this._boot()};o.prototype._boot=function(){this._bundleType=this._bundleSelectEl.options[this._bundleSelectEl.selectedIndex].value,this._loadProductList(),this._bindBundleTypeSelect(),this._bindBogoBundle(),this._bindGroupBundle(),this._bindComboBundle(),this._bindExistingTables(),t||(this._triggerBootEvents(),t=!0)},o.prototype._triggerBootEvents=function(){this._onBundleTypeChange(null)},o.prototype._bindExistingTables=function(){for(var t=e.$All(".js-remove-product-row"),o=e.$All(".js-product-qnty-select"),r=e.$All(".js-combo-products-table, .js-group-products-table, .js-bogo-products-in-table, .js-bogo-products-out-table"),s=e.$All(".js-combo-remove-trigger"),n=0;n<t.length;n++)e.addEventListener(t[n],"click",this._removeTableRowHandler);for(var i=0;i<o.length;i++)e.addEventListener(o[i],"change",this._quanityAdjustmentHandler);for(var a=0;a<r.length;a++)this._setTableTotalPrice(r[a]);for(var l=0;l<s.length;l++)e.addEventListener(s[l],"click",this._removeComboTableHandler)},o.prototype._loadProductList=function(){var t=document.createElement("DIV"),o=e.$(".js-bundle-product-list").cloneNode(!0);o.classList.remove("hidden"),t.appendChild(o),this._productsList=t.innerHTML},o.prototype._bindBundleTypeSelect=function(){e.addEventListener(this._bundleSelectEl,"change",this._onBundleTypeChange)},o.prototype._bindBogoBundle=function(){e.addEventListener(this._bogoProductsTriggerIn,"click",this._showProductChooser),e.addEventListener(this._bogoProductsTriggerOut,"click",this._showProductChooser)},o.prototype._bindGroupBundle=function(){e.addEventListener(this._groupProductsTrigger,"click",this._showProductChooser),e.addEventListener(this._groupPercentDiscountEl,"input",this._updateGroupPrice),e.addEventListener(this._groupFixedPriceEl,"input",this._updateGroupPrice),e.addEventListener(this._groupCentsOverrideEl,"input",this._updateGroupPrice)},o.prototype._bindComboBundle=function(){for(var t=0;t<this._comboProductsTriggers.length;t++)e.addEventListener(this._comboProductsTriggers[t],"click",this._showProductChooser);e.addEventListener(this._comboAddTableEl,"click",this._addComboTable)},o.prototype._onBundleTypeChange=function(t){t=t||window.event;var o=t?Modules.get("WriterBundles"):this;o._bundleType=o._bundleSelectEl.options[o._bundleSelectEl.selectedIndex].value;for(var r=0;r<o._bundleTypeOptionsWraps.length;r++)o._bundleTypeOptionsWraps[r].dataset.bundleType===o._bundleType?e.addClass(o._bundleTypeOptionsWraps[r],"active"):e.removeClass(o._bundleTypeOptionsWraps[r],"active")},o.prototype._updateGroupPrice=function(t){t=t||window.event;var o=t?Modules.get("WriterBundles"):this;if(e.hasClass(o._groupProductsTable,"empty-table"))return void(o._groupTotalPriceEl.innerHTML="0.00");var r=String(o._groupCentsOverrideEl.value).trim(),s=o._getTableFullPrice(o._groupProductsTable),n=o._groupPercentDiscountEl.value.trim(),i=o._groupFixedPriceEl.value.trim();if(0===s)return void(o._groupTotalPriceEl.innerHTML="0.00");if(""!==i)return void(o._groupTotalPriceEl.innerHTML=parseFloat(i).toFixed(2));if(""!==n){if(n=parseInt(n),0===n)return void(o._groupTotalPriceEl.innerHTML=s.toFixed(2));var a=(100-n)/100;s=(s*a).toFixed(2),""!==r&&(r=String(r).substring(0,2),s=String(s),s=s.substr(0,s.indexOf("."))+"."+r),o._groupTotalPriceEl.innerHTML=s}else o._groupTotalPriceEl.innerHTML=s.toFixed(2)},o.prototype._getTableFullPrice=function(t){for(var o=0,r=e.$All(".js-product-entry",t),s=0;s<r.length;s++){var n=parseFloat(r[s].dataset.productSalePrice)*parseInt(r[s].dataset.quantity);o+=n}return o},o.prototype._showProductChooser=function(){var t,o=Modules.get("WriterBundles"),r=this;t=r===o._bogoProductsTriggerIn?o._bogoProductsTableIn:r===o._bogoProductsTriggerOut?o._bogoProductsTableOut:r===o._groupProductsTrigger?o._groupProductsTable:e.$(".js-combo-products-table",e.previousUntillType(r,"div")),Modules.get("Modal",{type:"default bundle-selection-modal",title:"Make A Selection",message:"",closeText:"Cancel",closeClass:"btn-default",confirmClass:"btn-success",confirmText:"Save Selection",overlay:"dark",extras:o._productsList,onRender:function(){o._addProductListSelectionListeners(this),o._setSelectedProductList(this,t)},validateConfirm:function(){return o._validateModalConfirm(this,t)}})},o.prototype._setSelectedProductList=function(t,o){for(var r=e.$All(".js-product-entry",o),s=0;s<r.length;s++){var n=e.$('li[data-sku="'+r[s].dataset.sku+'"][data-product-id="'+r[s].dataset.productId+'"]',t);n.dataset.quantity=r[s].dataset.quantity,e.addClass(n,"active")}},o.prototype._addProductListSelectionListeners=function(t){for(var o=e.$All("li",t),r=0;r<o.length;r++)e.addEventListener(o[r],"click",function(){e.toggleClass(this,"active")})},o.prototype._validateModalConfirm=function(t,o){var r=Modules.get("WriterBundles"),s=r._getSelectedProducts(t);return e.empty(s)?(Modules.require("Notifications",{type:"warning",msg:"You need to select at least one product."}),!1):(r._insertTableProducts(s,o),!0)},o.prototype._getSelectedProducts=function(t){for(var o=[],r=e.$All("li",t),s=0;s<r.length;s++){var n=r[s];e.hasClass(n,"active")&&o.push({quantity:n.dataset.quantity,product_id:n.dataset.productId,sku:n.dataset.sku,image:n.dataset.productImage,title:n.dataset.productTitle,offer_name:n.dataset.productOffer,price:n.dataset.productPrice,sale_price:n.dataset.productSalePrice})}return o},o.prototype._insertTableProducts=function(t,o){this._clearTable(o),e.removeClass(o,"empty-table");for(var r=(this._getInputSuffixForTable(o),0),s=0;s<t.length;s++)this._insertTableRow(t[s],o),r+=parseFloat(t[s].sale_price);this._insertSummaryRow(o,r),"group"===this._bundleType&&this._updateGroupPrice()},o.prototype._insertTableRow=function(t,o){var r=this._getInputSuffixForTable(o),s=document.createElement("tr"),n=(parseInt(t.quantity)*parseFloat(t.price)).toFixed(2),i=(parseInt(t.quantity)*parseFloat(t.sale_price)).toFixed(2),a='<select name="bundle_product'+r+'_quantities[]" class="js-product-qnty-select">';s.className="js-product-entry";for(var l=1;11>l;l++){var d=parseInt(t.quantity)===l?"selected":"";a=a+'<option value="'+l+'" '+d+">"+l+"</option>"}s.innerHTML=["<th>",'<span class="form-field">',a,"</span>","</th>","<th>",'<img width="100" height="100" src="'+t.image+'" alt="'+t.title+'">',"</th>","<td><strong>"+t.title+"</strong> - "+t.offer_name+"</td>",'<td><span class="color-gray"><del>$<span class="js-reg-price">'+n+"</span></del></span></td>",'<td>$<span class="js-sale-price">'+i+"</span></td>","<td>",'<button type="button" class="btn btn-outline btn-xs js-remove-product-row">','<span class="glyph-icon glyph-icon-minus"></span>',"</button>",'<input type="hidden" class="hidden" name="bundle_product'+r+'_ids[]" value="'+t.product_id+'">','<input type="hidden" class="hidden" name="bundle_product_offer'+r+'_ids[]" value="'+t.sku+'">',"</td>"].join(""),s.dataset.quantity=t.quantity,s.dataset.productId=t.product_id,s.dataset.sku=t.sku,s.dataset.productTitle=t.title,s.dataset.productOffer=t.offer_name,s.dataset.productPrice=t.price,s.dataset.productSalePrice=t.sale_price,e.$("tbody",o).appendChild(s),e.addEventListener(e.$(".js-remove-product-row",s),"click",this._removeTableRowHandler),e.addEventListener(e.$(".js-product-qnty-select",s),"change",this._quanityAdjustmentHandler)},o.prototype._getInputSuffixForTable=function(e){var t="";if("bogo"===this._bundleType)e===this._bogoProductsTableIn?t="_bogo_in":e===this._bogoProductsTableOut&&(t="_bogo_out");else if("combo"===this._bundleType)for(var o=0;o<this._comboProductsTables.length;o++)if(e===this._comboProductsTables[o]){t="_combo_"+(o+1);break}return t},o.prototype._insertSummaryRow=function(t,o){var r=document.createElement("tr");r.className="price-summary",r.innerHTML=["<td><strong>Total</strong></td>","<td></td>","<td></td>","<td></td>",'<td><strong>$<span class="js-table-price-total">'+o.toFixed(2)+"</span></strong></td>","<td></td>"].join(""),e.$("tbody",t).appendChild(r)},o.prototype._quanityAdjustmentHandler=function(t){t=t||window.event;var o=Modules.get("WriterBundles"),r=e.closest(this,"tr"),s=e.closest(this,"table"),n=parseInt(this.options[this.selectedIndex].value),i=parseFloat(r.dataset.productPrice),a=parseFloat(r.dataset.productSalePrice);r.dataset.quantity=n,e.$(".js-reg-price",r).innerHTML=(i*n).toFixed(2),e.$(".js-sale-price",r).innerHTML=(a*n).toFixed(2),o._setTableTotalPrice(s),"group"===o._bundleType&&o._updateGroupPrice()},o.prototype._clearTable=function(t){for(var o=e.$All("tbody > tr",t),r=0;r<o.length;r++)e.removeFromDOM(o[r]);e.addClass(t,"empty-table")},o.prototype._removeTableRowHandler=function(t){t=t||window.event;var o=Modules.get("WriterBundles"),r=e.closest(this,"tr"),s=e.closest(this,"table");e.removeFromDOM(r),o._setTableTotalPrice(s),"group"===o._bundleType&&o._updateGroupPrice()},o.prototype._setTableTotalPrice=function(t){var o=e.$All(".js-product-entry",t),r=e.$(".js-table-price-total",t);return 0===o.length?(this._clearTable(t),void e.addClass(t,"empty-table")):void(r&&(r.innerHTML=this._getTableFullPrice(t).toFixed(2)))},o.prototype._removeComboTableHandler=function(){var t=e.closest(this,"div");e.removeFromDOM(t)},o.prototype._addComboTable=function(t){t=t||window.event;var o=Modules.get("WriterBundles"),r=document.createElement("div");r.className="row floor-xs",r.innerHTML=['<p class="text-italic color-gray">Customers can select from <strong>any</strong> of these products.</p>','<div class="form-field row floor-xs">',"<label>Selection Name</label>",'<input type="text" name="bundle_combo_names[]" placeholder="Free Gift 1">',"</div>",'<div class="table-responsive"><table class="table empty-table js-combo-products-table"><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody></tbody></table></div>','<button class="btn btn-danger js-combo-remove-trigger" type="button">Remove selection</button>&nbsp;&nbsp;&nbsp;','<button class="btn js-combo-products-trigger" type="button">Select Products</button>'].join(""),o._comboOptionsWrap.insertBefore(r,o._comboAddTableEl.parentNode),o._comboProductsTables=e.$All(".js-combo-products-table"),e.addEventListener(e.$(".js-combo-products-trigger",r),"click",o._showProductChooser),e.addEventListener(e.$(".js-combo-remove-trigger",r),"click",o._removeComboTableHandler)},Modules.singleton("WriterBundles",o).get("WriterBundles")}();